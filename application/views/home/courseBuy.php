<?phpdefined('BASEPATH') OR exit('No direct script access allowed');?><!DOCTYPE html><html><head>    <?php    include_once 'public/views/home/header.php';    ?>    <link href="cust/js/videojs/video-js.min.css" rel="stylesheet">    <link rel="stylesheet" href="cust/css/mb.css">    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><style type="text/css">    #tab1 img{        width: 100%;    }    #tab2 img{        width: 100%;    }    .buttons-tab{        position: relative;    }    .fixx:before{        content: '';        width: 1px;        height: 50%;        position: absolute;        left: 50%;        top: 50%;        background: #d2d2d2;        transform: translate(-50%,-50%);    }</style></head><body><div class="page-group">    <div class="page page-current">        <!-- 标题栏 -->        <header class="bar bar-nav">            <a class="button button-link button-nav pull-left back" >                <span class="icon icon-left"></span>                返回            </a>            <h1 class='title'><?=$title?></h1>        </header>        <div class="bar bar-footer" style="height: 55px;padding-right: unset">            <div class="row" style="height: 100%;background: white ">                <div class="col-33" style="width: 34px;height: 34px;text-align: center;background: #e8e8e8;border-radius: 50%;transform: translate(0,12.5px)">                    <a href="Home/index" style="width: 100%;height: 100%;display: inline-block;padding: 8px" class="external"><img style="vertical-align: unset" width="100%" src="cust/images/sy1.png" /></a>                </div>                <div class="col-60" style="float: right;padding: 0 10px 0 0 ;width: 70%">                    <?php                    if($isBuy){                        ?>                        <a href="Home/my/myGroupDetail/<?=$order_detail['id']?>" class="external button button-round button-fill" style="background: #FFBA00;color:#000;margin: 0 auto;width: 70%;top: .75rem">查看详情</a>                        <?php                    }else{                        if(!$is_fx){                        ?>                        <p class="buttons-row" style="margin: 0px;transform: translate(0,4px)"><a href="#" onclick="buy(0,<?=estr($detail,'id')?>,<?=estr($detail,'price')?>)" class="button button-round" style="height:35px;line-height:35px!important;font-size:12px;background-color:#FFBA00;border: 0px;color:#000000;border-right:2px solid #ffffff;font-weight: bold">                                单人团￥<?=estr($detail,'price')?></a>                    <?php                        }                    ?>                            <a href="#" onclick="buy(1,<?=estr($detail,'id')?>,<?=estr($detail,'p_price')?>)" class="button button-round active" style="height:35px;line-height:35px!important;font-size:12px;background-color:#FFBA00;border: 0px;color:#000000;font-weight: bold">三人团￥<?=estr($detail,'p_price')?></a></p>                    <?php }                    ?>                </div>            </div>        </div>        <!-- 这里是页面内容区 -->        <!-- 这里是页面内容区 -->        <div class="content" style="background-color: #ffffff;overflow-x: hidden;top:.3rem">            <div >                <div class="content-block" style="<?php if(isset($zs_video_big)) echo 'padding:0px;'; ?> margin: 0px;">                    <input type="hidden" id="fx_id" value="<?= $fx_id ?>"/>                    <input type="hidden" id="share_id" value="<?= $share_id ?>"/>                    <?php                    if (isset($zs_video_big)){                        ?>                        <div style="width: 100%">                            <img width="100%" src="<?php  echo $detail['logo']?$detail['logo']:'cust/images/toplog.png';?>" alt="">                        </div>                        <?php                    }?>                    <div class="row" style="">                        <div class="col-100 kc_list">                            <?php                            if (isset($zs_video_big)){                            ?>                            <video id='my_video' class='video-js' controls preload='auto' style="width: 100%;height: 10rem;"                                   poster='<?= $zs_video_big['thumb'] ?>' data-setup='{}' x-webkit-airplay="true"                                   x5-playsinline="true" webkit-playsinline="true" playsinline="true">                                <source src='<?= $zs_video_big['url'] ?>' type='video/mp4'>                            </video>                        </div>                        <?php                        } else {                            $srcImg = $detail['article_image'];                            if ($detail['article_image_big']) {                                $srcImg = $detail['article_image_big'];                            }                            ?>                            <img width="100%" height="197px" style="border-radius: 0.8rem;" src="<?= $srcImg ?>"/>                            <?php                        }                        ?>                    </div>                </div>            </div>            <div style="padding: 0 0.75rem">                <div class="col-100 kc-title" style="font-weight: bold">                    <?= estr($detail, 'title') ?>                </div>                <div class="col-100 kc-price ">                    <div class="row  ">                        <div class="col-20"                             style="width: unset;color:red;font-size: 1rem;font-weight: bold;float: left">                            ￥<?= estr($detail, 'p_price') ?></div>                        <div class="col-15"                             style="width:unset;margin-left:unset;float:left;color: #dedede;font-size: 12px;line-height: 1.6rem;margin-left: 5px;">                            起                        </div>                        <div class="col-20" style="font-size: 12px;    width: 30%;    line-height: 2rem;    padding-left: 0.4rem;float: right">                            等<?= count($buyList) ?>个人团购成功                        </div>                        <div class="col-30" style="float: right">                            <div class="avatar-list avatar-list-stacked">                                <?php                                $i = 0;                                foreach ($buyList as $buy) {                                    if ($i > 4) break;                                    $i++;                                    ?>                                    <span class="avatar cover-image brround" data-image-src="<?= $buy['head_img'] ?>"                                          style="background-image: url('<?= $buy['head_img'] ?>') ">                                            </span>                                    <?php                                }                                ?>                            </div>                        </div>                    </div>                    <div class="kc-after" style="padding-top:0rem "></div>                </div>            </div>            <div class="row " style="padding: 0 0.75rem">                <div class="col-100">                    <ul class="tags-ul">                        <?php                        foreach ($tags_list as $k => $tag) {                            if ($tag == "") continue;                            ?>                            <li>                                <span style=" width: 16px; height: 18px; background: url('cust/images/类别.png') center center no-repeat; display: inline-block; background-size:100%; transform: translate(0,3.5px);"                                      class="iconfont icon-icon1"></span>                                <i style="font-size: 14px !important;margin-left:3px"><?= $tag ?></i></li>                            <?php                        }                        ?>                    </ul>                </div>            </div>            <div class=" row sq-after" style="border-bottom: 1rem solid #f6f6f6"></div>            <div class="row">                <div class="col-100">                    <div class="buttons-tab fixed-tab fixx" data-offset="44"                         style="display:flex;justify-content: center">                        <a href="#tab1" class="tab-link active button"                           style="width:25%;margin-right:4rem;line-height: 50px !important;height: 2.5rem;font-size: 1rem">课程详情</a>                        <a href="#tab2" class="tab-link button"                           style="width:25%;line-height: 50px !important;height: 2.5rem;font-size: 1rem">购买须知</a>                    </div>                    <div class="tabs">                        <div id="tab1" class="tab active">                            <div class="content-block">                                <?= estr($detail, 'content') ?>                            </div>                        </div>                        <div id="tab2" class="tab">                            <div class="content-block">                                <?= estr($detail, 'remark') ?>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div></div></div>    <?php    include_once 'public/views/home/script.php';    ?><script type="text/javascript" src="cust/js/videojs/video.min.js"></script><script type="text/javascript">    if(document.getElementById("my_video")){        var myPlayer = videojs("my_video");    }    function buy(type,id,price) {        var coupon = <?=$coupon_price?>;        var max_coupon = <?=$detail['max_coupon']?>;        if(max_coupon != -1 &&coupon > max_coupon){            coupon = max_coupon;        }        if(coupon > price){            coupon = price;        }        var zf_price = price- coupon;        var html = '<ul class="gm_ul">';        html+= '<li style="padding:10px 0;text-align: center;border-bottom: 1px solid #d9d9d9;margin: 0;line-height: 1.8rem;font-size: 1rem;"><span style="float:left;position: absolute;left: 0;padding-left: 10px" onclick="closeLayer()"><img width="60%" src="cust/images/close.png"></span><span style="text-align: center">付款详情</span></li>';        html+= '<li><span>课程名称</span><span style="float:right"><?=estr($detail,'title')?></span></li>';        html+= '<li><span>代金卷</span><span style="float:right;color:red">￥-'+coupon+'</span></li>';        html+= '<li><span>支付金额</span><span style="float:right">￥'+zf_price+'</span></li>';        html+= '<li><span>微信支付</span><span style="float:right"><img src="cust/images/wx.png" style="width: 1rem"></span></li>';        html+= '<li style="display: flex;justify-content: center""><a  class="button button-fill" style="background-color: #f9a123;width: 11rem;border-radius: 1rem;line-height: 2rem !important;height: 2rem;font-size: 1rem;" onclick="callbuy('+type+','+id+','+zf_price+','+coupon+',this)">确认支付</a></li>';        layer.open({            shadeClose: false,            type: 1            ,content: html            ,anim: 'up'            ,style: 'position:fixed; bottom:0; left:0; width: 100%; height: 267px; padding:10px 0;' +                ' border:none;border-top-left-radius:0.5rem;border-top-right-radius:0.5rem;'        });    }    function closeLayer() {        layer.closeAll()    }    function callbuy(type,id,zf_price,coupon,obj) {        $(obj).removeAttr('onclick');        var fx_id = $('#fx_id').val();        var url = "Home/order/buy";        var share_id = <?php echo isset($share_id)?$share_id:0; ?>;        if(fx_id){            url +="/"+ fx_id;        }        $.post(url,{id:id,type:type,fx_id:fx_id,share_id:share_id,zf_price:zf_price,coupon:coupon},function (data) {            if(data.status){                console.log(data);                closeLayer();                var order = JSON.parse(data.v);                var url = "Home/order/startPay/"+order.order_number;                window.location.href=url            }else{                alert("支付失败");                layer.closeAll();            }        },'json');    }    wx.config({        debug: true,        appId: "<?=$signPackage['appId']?>",        timestamp: <?=$signPackage['timestamp']?>,        nonceStr: "<?=$signPackage['nonceStr']?>",        signature: "<?=$signPackage['signature']?>",        jsApiList: ['onMenuShareAppMessage',            'onMenuShareTimeline',            'chooseWXPay',            'showOptionMenu',            "updateAppMessageShareData",            "hideMenuItems",            "showMenuItems",            "onMenuShareTimeline",            'onMenuShareAppMessage']    });    wx.ready(function() {            //分享到朋友圈            wx.updateAppMessageShareData({                title: "<?=$detail['title']?>",                desc: "分享课程",                link: 'http://fineui.dye360.cn/Home/Course/buy/<?=$detail['id']?>/<?=$_SESSION['app_home_session']['id']?>',                imgUrl:"<?=$detail['article_image']?>" ,                success: function() {                    getFxPrice()                    alert("分享成功！")                    // 用户确认分享后执行的回调函数                },                cancel: function() {                    alert("取消分享！")                    // 用户取消分享后执行的回调函数                }            });        //分享给朋友        wx.onMenuShareAppMessage({            title: "<?=$detail['title']?>",            desc: "分享课程",            link: 'http://fineui.dye360.cn/Home/course/buy/<?=$detail['id']?>/<?=$_SESSION['app_home_session']['id']?>',            imgUrl:"<?=$detail['article_image']?>" ,            success: function() {                getFxPrice()                alert("分享成功！")                // 用户确认分享后执行的回调函数            },            cancel: function() {                alert("取消分享！")                // 用户取消分享后执行的回调函数            }        });    });    function  getFxPrice() {        var url = "Home/myCourse/fxGetCoupon/<?=$detail['id']?>";        $.getJSON(url,function (data) {            // alert(data.msg);        })    }</script></body></html>